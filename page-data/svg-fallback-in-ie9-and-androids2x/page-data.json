{"componentChunkName":"component---src-templates-blog-post-js","path":"/svg-fallback-in-ie9-and-androids2x","result":{"data":{"markdownRemark":{"html":"<p>Как-то у меня возник интересный вопрос. Есть <a href=\"https://www.npmjs.org/package/svg_fallback\">решение</a> для замены инлайнового SVG на фоновые картинки в браузерах, где инлайновый SVG не поддерживается. Оно построено на допущении, что на странице есть нужный нам класс <code>.ie8</code>, по которому SVG-элементам включаются фоновые изображения.</p>\n<p>Очевидный недостаток способа состоит в том, что мы должны  отдельно позаботиться о том, чтобы нужный нам класс был — при генерации страницы на сервере или же определив браузер с помощью JS.</p>\n<!--more-->\n<p>Второй очевидный недостаток состоит в том, что способ не годится для других браузеров без поддержки инлайнового SVG, например, Оперы Мини и Андроидов 2.x.</p>\n<p>Мне стало интересно: можно ли обеспечить поддержку во всех старых браузерах, используя только CSS?</p>\n<p>И, кажется, я нашла решение. Оно странное, но работает. Меня интересовала его работоспособность в следующих браузерах:</p>\n<ul>\n<li>IE8 и 9</li>\n<li>Android 2.x</li>\n<li>Opera 12, Opera Mini</li>\n</ul>\n<p>Тестировалось вот на такой конструкции:</p>\n<p> SVG:</p>\n<div class=\"gatsby-highlight\" data-language=\"markup\"><pre class=\"language-markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2000/svg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>svg-icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>circle</span> <span class=\"token attr-name\">r</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>55<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cx</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cy</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">fill</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>yellowgreen<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>text</span> <span class=\"token attr-name\">x</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>50%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dy</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>.4em<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">text-anchor</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>middle<span class=\"token punctuation\">\"</span></span><span class=\"token style-attr language-css\"><span class=\"token attr-name\">\n      <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token property\">font</span><span class=\"token punctuation\">:</span> 38px/1 Trebuchet MS<span class=\"token punctuation\">;</span> <span class=\"token property\">fill</span><span class=\"token punctuation\">:</span> #FFF</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>SVG<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>text</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>CSS:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.svg-icon</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-block<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 3em 2em<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 180px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 130px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>https://img-fotki.yandex.ru/get/5807/5091629.a3/0_86371_b2660de0_orig<span class=\"token punctuation\">)</span></span>\n        no-repeat center center<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid #555<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Если SVG не поддерживается браузером, мы увидим — только эту фоновую картинку:</p>\n<img src=\"https://img-fotki.yandex.ru/get/5807/5091629.a3/0_86371_b2660de0_orig\"/>\n<p>Если поддерживается — и фон, и SVG. Если вы смотрите страницу в современном браузере, демо покажет вам именно этот вариант:</p>\n<iframe height=\"350\"\n      style=\"width: 100%\"\n      title=\"no title\"\n      src=\"http://codepen.io/yoksel/embed/sbzEp/?&default-tab=result\"\n    ></iframe>\n<p><i>На самом деле, в браузерах без поддержки SVG также будет виден текст \"SVG\", но в реальной жизни это вряд ли будет проблемой, если только вы не кладете текст в иконки.</i></p>\n<p>Задача состоит в том, чтобы в браузерах с поддержкой SVG убирать фон.</p>\n<p>Картинки для понятности:</p>\n<p><img src=\"https://img-fotki.yandex.ru/get/6734/5091629.a3/0_86377_63bd7b1e_orig\" class=\"vlm\"/> — сейчас демо выглядит вот так</p>\n<p><img src=\"https://img-fotki.yandex.ru/get/6828/5091629.a3/0_86372_1655bbc0_orig.png\" class=\"vlm\"/> — так оно должно выглядеть в браузерах без поддержки SVG</p>\n<p><img src=\"https://img-fotki.yandex.ru/get/2914/5091629.a3/0_86378_6105ccc8_orig\" class=\"vlm\"/> — а вот так в браузерах, где SVG поддерживается</p>\n<p>То есть по умолчанию всегда показывается PNG-заглушка, и её нужно скрыть только в современных браузерах. Нам нужна некая конструкция в CSS, поддержка которой в разных браузерах совпадает с поддержкой SVG.</p>\n<p>Первым делом в голову приходит вариант с множественными фонами, например:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token property\">background</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">,</span> none<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Хороший вариант, но браузеры Android 2.x понимают множественные фоны и не понимают SVG, поэтому в них при таком способе на странице не будет ни того, ни другого.</p>\n<p>Ссылка для тестирования: <a href=\"http://codepen.io/yoksel/full/FirKg\">http://codepen.io/yoksel/full/FirKg</a>.</p>\n<p>Следующая идея убирать фон с помощью <a href=\"http://pauginer.com/post/36614680636/invisible-gradient-technique\">невидимого градиента</a>.</p>\n<p>Примерный код:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>transparent<span class=\"token punctuation\">,</span> transparent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Способ работает везде, где нужно, кроме IE9 — он не понимает градиенты, поэтому в нем будут отображаться и SVG, и фон.</p>\n<p>Ссылка для тестирования: <a href=\"http://codepen.io/yoksel/full/fxCzH\">http://codepen.io/yoksel/full/fxCzH</a>.</p>\n<p>Нужно какое-то решение, которое уберет фон в IE9 и ничего не поломает в остальных.</p>\n<p>Мне не удалось найти ничего подходящего в CSS-свойствах для <a href=\"http://caniuse.com/#search=background\">управления фоном</a>, но зато кое-что интересное неожиданно обнаружилось в <a href=\"http://caniuse.com/#search=viewport%20units\">единицах измерения</a>.</p>\n<p>Если для управления размерами или положением фона использовать единицы вьюпорта — <code>vw</code>  или <code>vh</code>, браузеры Android 2.x и Opera Mini полностью проигнорируют свойство, где они содержатся. То есть можно написать:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> -1000vh 0<span class=\"token punctuation\">;</span></code></pre></div>\n<p>и этот код уберет фоновое изображение в IE9.</p>\n<p>Не все браузеры понимают единицы вьюпорта, так что в финальной версии кода нужно комбинировать оба последних способа:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* современные браузеры кроме IE9 */</span>\n<span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>transparent<span class=\"token punctuation\">,</span> transparent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token comment\">/* IE9 */</span>\n<span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> -1000vh 0<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Демо:</p>\n<iframe height=\"350\"\n      style=\"width: 100%\"\n      title=\"no title\"\n      src=\"http://codepen.io/yoksel/embed/tKzeB/?&default-tab=result\"\n    ></iframe>\n<p>Ссылка для тестирования: <a href=\"http://codepen.io/yoksel/full/tKzeB\">codepen.io/yoksel/full/tKzeB</a></p>\n<p>Возможно, я что-то упустила, но на данный момент мои тесты показывают, что этот способ работает.</p>\n<p>Браузеры, где проверяла:</p>\n<ul>\n<li>IE8 и 9</li>\n<li>Android 2.3</li>\n<li>Opera 12, Opera Mini</li>\n</ul>\n<p>Для проверки в Android 2.3 я использовала <a href=\"http://www.browserstack.com/screenshots\">browserstack.com/screenshots</a>, выбрав там Samsung Galaxy S2. Буду признательна, если кто-то потестит на реальном девайсе и сообщит о результатах.</p>\n<p>Вообще если у вас есть возможность потестить <a href=\"http://codepen.io/yoksel/full/tKzeB\">демо</a> на устройствах, где может быть проблема с инлайновым SVG, — проверьте, пожалуйста, и сообщите как оно там — этот способ на данный момент нуждается в основательном тестировании.</p>\n<p>Хочется надеяться, что постепенно старые устройства канут в лету, и нам больше не надо будет изобретать такие странные решения на стыке магии и CSS.</p>","frontmatter":{"title":"Трюк на CSS для поддержки SVG в старых браузерах","desc":"Есть решение для замены инлайнового SVG на фоновые картинки в браузерах, где инлайновый SVG не поддерживается. Оно построено на допущении, что на странице есть нужный нам класс .ie8, по которому SVG-элементам включаются фоновые изображения. Мне стало интересно: можно ли обеспечить поддержку способа во всех старых браузерах, используя только CSS?","image":"https://img-fotki.yandex.ru/get/6734/5091629.a3/0_86377_63bd7b1e_orig","customCSS":null,"customJs":null,"tags":["svg"],"layout":null,"links":[{"desc":null,"name":"The invisible gradient technique: Cross-browser support for SVG (with image fallback) using CSS","url":"http://pauginer.com/post/36614680636/invisible-gradient-technique"},{"desc":null,"name":"Грабли на чистом SVG","url":"/svg-in-ie8"},{"desc":null,"name":"svg_fallback (plugin)","url":"https://www.npmjs.org/package/svg_fallback"},{"desc":null,"name":"Зачем я написала плагин для Grunt","url":"/grunt-plugin"},{"desc":null,"name":"Using SVG on Android 2.x","url":"http://blogs.telerik.com/kendoui/posts/12-02-17/using_svg_on_android_2_x_and_kendo_ui_dataviz"}]}}},"pageContext":{"slug":"svg-fallback-in-ie9-and-androids2x","date":"01/11/2014","url":"/svg-fallback-in-ie9-and-androids2x","type":"post","includeContent":"","isArchived":true,"previous":{"frontmatter":{"title":"Режимы наложения и их фоллбеки"},"fields":{"url":"/blend-modes-fallback","type":"post","isArchived":true}},"next":{"frontmatter":{"title":"Обновление плагина svg_fallback"},"fields":{"url":"/svg-fallback-update","type":"post","isArchived":true}}}}}